load_secrets()
# GLOBAL VARIABLES ---------------------------------------------------------------
# folder where monthly submissions are stored. Update monthly!
folder_month <- "2023_06"
path_monthly_input_repo <- glue::glue("Data/Ajuda/ER_DSD_TPT_VL/{folder_month}/")
input_files <- dir({path_monthly_input_repo}, pattern = "*.xlsx")
# paths for saving monthly datasets on local drive
path_monthly_imer_output_file <- glue::glue("Dataout/IMER/monthly_processed/IMER_{folder_month}.txt")
path_monthly_prep_output_file <- glue::glue("Dataout/PrEP/monthly_processed/PREP_{folder_month}.txt")
path_monthly_dsd_output_file <- glue::glue("Dataout/DSD/monthly_processed/DSD_{folder_month}.txt")
path_monthly_mi_output_file <- glue::glue("Dataout/MI/monthly_processed/MI_{folder_month}.txt")
path_monthly_tpt_output_file <- glue::glue("Dataout/TPT/monthly_processed/TPT_{folder_month}.txt")
path_monthly_txtb_output_file <- glue::glue("Dataout/TXTB/monthly_processed/TXTB_{folder_month}.txt")
# paths for saving monthly datasets on google drive
path_monthly_imer_output_gdrive <- as_id("https://drive.google.com/drive/folders/12bkLnrQNXbKpbyo-zwk9dmxS6NHDyLwU")
path_monthly_prep_output_gdrive <- as_id("https://drive.google.com/drive/folders/1BYq-xdMhxw8sOUHYwFiZH8_w2UsQmBun")
path_monthly_dsd_output_gdrive <- as_id("https://drive.google.com/drive/folders/15x2biGIIYrY_eW-zrKQbrvMT47cI5yOE")
path_monthly_mi_output_gdrive <- as_id("https://drive.google.com/drive/folders/1RC5VFhD7XkuptW7o3zd21ujY6CefcTyv")
path_monthly_tpt_output_gdrive <- as_id("https://drive.google.com/drive/folders/1JobyoQqeTP3M5VvZWMC4AMBW04nVwDeD")
path_monthly_txtb_output_gdrive <- as_id("https://drive.google.com/drive/folders/1zKg8l6bmO_6uk9GoOmxYsAWP3msHtjB3")
# paths for saving historic datasets on local drive
path_historic_imer_output_file <- "Dataout/em_imer.txt"
path_historic_prep_output_file <- "Dataout/em_prep.txt"
path_historic_dsd_output_file <- "Dataout/em_dsd.txt"
path_historic_mi_output_file <- "Dataout/em_mi.txt"
path_historic_tpt_output_file <- "Dataout/em_tpt.txt"
path_historic_txtb_output_file <- "Dataout/em_txtb.txt"
# path for saving historical datasets on google drive
path_historic_output_gdrive <- as_id("https://drive.google.com/drive/folders/1xBcPZNAeYGahYj_cXN5aG2-_WSDLi6rQ")
# 1. LOAD SITE META DATA ---------------------------------------------------------------
ajuda_site_map <- pull_sitemap()
# imer
df_em_imer <- input_files %>%
map(~ reshape_em_imer(file.path(path_monthly_input_repo, .)), .progress	= TRUE) %>%
reduce(rbind)
# write_tsv NA values to ""
# check monthly submission headers
# DEPENDENCIES ------------------------------------------------------------
library(tidyverse)
library(mozR)
library(glamr)
library(googlesheets4)
library(googledrive)
library(fs)
library(lubridate)
library(janitor)
library(readxl)
library(openxlsx)
library(glue)
library(gt)
load_secrets()
# GLOBAL VARIABLES ---------------------------------------------------------------
# folder where monthly submissions are stored. Update monthly!
folder_month <- "2023_06"
path_monthly_input_repo <- glue::glue("Data/Ajuda/ER_DSD_TPT_VL/{folder_month}/")
input_files <- dir({path_monthly_input_repo}, pattern = "*.xlsx")
# paths for saving monthly datasets on local drive
path_monthly_imer_output_file <- glue::glue("Dataout/IMER/monthly_processed/IMER_{folder_month}.txt")
path_monthly_prep_output_file <- glue::glue("Dataout/PrEP/monthly_processed/PREP_{folder_month}.txt")
path_monthly_dsd_output_file <- glue::glue("Dataout/DSD/monthly_processed/DSD_{folder_month}.txt")
path_monthly_mi_output_file <- glue::glue("Dataout/MI/monthly_processed/MI_{folder_month}.txt")
path_monthly_tpt_output_file <- glue::glue("Dataout/TPT/monthly_processed/TPT_{folder_month}.txt")
path_monthly_txtb_output_file <- glue::glue("Dataout/TXTB/monthly_processed/TXTB_{folder_month}.txt")
# paths for saving monthly datasets on google drive
path_monthly_imer_output_gdrive <- as_id("https://drive.google.com/drive/folders/12bkLnrQNXbKpbyo-zwk9dmxS6NHDyLwU")
path_monthly_prep_output_gdrive <- as_id("https://drive.google.com/drive/folders/1BYq-xdMhxw8sOUHYwFiZH8_w2UsQmBun")
path_monthly_dsd_output_gdrive <- as_id("https://drive.google.com/drive/folders/15x2biGIIYrY_eW-zrKQbrvMT47cI5yOE")
path_monthly_mi_output_gdrive <- as_id("https://drive.google.com/drive/folders/1RC5VFhD7XkuptW7o3zd21ujY6CefcTyv")
path_monthly_tpt_output_gdrive <- as_id("https://drive.google.com/drive/folders/1JobyoQqeTP3M5VvZWMC4AMBW04nVwDeD")
path_monthly_txtb_output_gdrive <- as_id("https://drive.google.com/drive/folders/1zKg8l6bmO_6uk9GoOmxYsAWP3msHtjB3")
# paths for saving historic datasets on local drive
path_historic_imer_output_file <- "Dataout/em_imer.txt"
path_historic_prep_output_file <- "Dataout/em_prep.txt"
path_historic_dsd_output_file <- "Dataout/em_dsd.txt"
path_historic_mi_output_file <- "Dataout/em_mi.txt"
path_historic_tpt_output_file <- "Dataout/em_tpt.txt"
path_historic_txtb_output_file <- "Dataout/em_txtb.txt"
# path for saving historical datasets on google drive
path_historic_output_gdrive <- as_id("https://drive.google.com/drive/folders/1xBcPZNAeYGahYj_cXN5aG2-_WSDLi6rQ")
# 1. LOAD SITE META DATA ---------------------------------------------------------------
ajuda_site_map <- pull_sitemap()
# imer
df_em_imer <- input_files %>%
map(~ reshape_em_imer(file.path(path_monthly_input_repo, .)), .progress	= TRUE) %>%
reduce(rbind)
input_files <- dir({path_monthly_input_repo}, pattern = "*.xlsx")
# imer
df_em_imer <- input_files %>%
map(~ reshape_em_imer(file.path(path_monthly_input_repo, .)), .progress	= TRUE) %>%
reduce(rbind)
# prep
df_em_prep <- input_files %>%
map(~ reshape_em_prep(file.path(path_monthly_input_repo, .)), .progress	= TRUE) %>%
reduce(rbind)
df <- read_excel("Data/Ajuda/ER_DSD_TPT_VL/2023_06/MonthlyEnhancedMonitoringTemplates_FY23Q3_1.2 DOD.xlsx",
sheet = "TX NEW, TX CURR AND IMER", skip = 8)
filename <- "Data/Ajuda/ER_DSD_TPT_VL/2023_06/MonthlyEnhancedMonitoringTemplates_FY23Q3_1.2 DOD.xlsx"
filename <- "Data/Ajuda/ER_DSD_TPT_VL/2023_06/MonthlyEnhancedMonitoringTemplates_FY23Q3_1.2 DOD.xlsx"
ip_temp <- extract_em_meta(filename, type = "ip")
month_temp <- extract_em_meta(filename, type = "month")
df <- readxl::read_excel(filename,
sheet = "TX NEW, TX CURR AND IMER",
skip = 8,
col_types = "text",
.name_repair = "unique_quiet") %>%
tidyr::pivot_longer(TX_NEWTot:TX_C_MISAU_AD_F_20p,
names_to = "indicator",
values_to = "value") %>%
dplyr::select(partner = Partner,
snu = Province,
psnu = District,
sitename = `Health Facility`,
datim_uid = DATIM_code,
indicator,
value) %>%
dplyr::inner_join(data_em_imer_var_map, by = "indicator") %>%
dplyr::filter(!indicator_new == "remove") %>%
tidyr::separate(indicator_new,
c("indicator", "sex", "age", "pop_type", "dispensation", "numdenom", "er_status", "dsd_eligibility"),
sep = "\\.") %>%
dplyr::mutate(across(everything(), ~ifelse(.=="", NA, as.character(.))),
value = as.numeric(value),
period = month_temp,
indicator = stringr::str_replace_all(indicator, "\\.", "_"),
age = stringr::str_replace_all(age, "\\_", "-"),
age = dplyr::recode(age,
`<1`  = "<01",
`1-4` = "01-04",
`5-9` = "05-09",
"unknown" = "Unknown Age"), # age coding correction
sex = dplyr::recode(sex,
"M" = "Male",
"F" = "Female",
"unknown" = "Unknown"),
key_pop = dplyr::case_when(pop_type == "FSW" ~ "FSW",
pop_type == "MSM" ~ "MSM",
pop_type == "PWID" ~ "PWID",
pop_type == "PPCS" ~ "PPCS"),
pop_type = dplyr::recode(pop_type,
"FSW" = "KP",
"MSM" = "KP",
"PWID" = "KP",
"PPCS" = "KP"),
pop_type = dplyr::case_when(age %in% c("<15", "<01", "01-04", "05-09", "10-14", "15+", "15-19", "20-24", "25-29", "30-34", "35-39", "40-44", "45-49", "50-54", "55-59", "60-64", "50+", "65+", "Unknown Age") ~ "By Age",
TRUE ~ pop_type),
numdenom = tidyr::replace_na(numdenom, "N"),
er_status = dplyr::recode(er_status,
"Initiated ART" = NA_character_)) %>%
dplyr::filter(partner == ip_temp) %>%
dplyr::select(partner,
snu,
psnu,
sitename,
datim_uid,
period,
indicator,
sex,
age,
pop_type,
key_pop,
dispensation,
numdenom,
er_status,
dsd_eligibility,
value)
tx_curr_prev <- df %>%
dplyr::filter(indicator == "TX_CURR") %>%
dplyr::mutate(indicator = dplyr::recode(indicator,
"TX_CURR" = "TX_CURR_Previous"),
period = period + months(1))
df <- dplyr::bind_rows(df, tx_curr_prev)
# write_tsv NA values to ""
# check monthly submission headers
# DEPENDENCIES ------------------------------------------------------------
library(tidyverse)
library(mozR)
library(glamr)
library(googlesheets4)
library(googledrive)
library(fs)
library(lubridate)
library(janitor)
library(readxl)
library(openxlsx)
library(glue)
library(gt)
load_secrets()
# folder where monthly submissions are stored. Update monthly!
folder_month <- "2023_06"
path_monthly_input_repo <- glue::glue("Data/Ajuda/ER_DSD_TPT_VL/{folder_month}/")
input_files <- dir({path_monthly_input_repo}, pattern = "*.xlsx")
# paths for saving monthly datasets on local drive
path_monthly_imer_output_file <- glue::glue("Dataout/IMER/monthly_processed/IMER_{folder_month}.txt")
path_monthly_prep_output_file <- glue::glue("Dataout/PrEP/monthly_processed/PREP_{folder_month}.txt")
path_monthly_dsd_output_file <- glue::glue("Dataout/DSD/monthly_processed/DSD_{folder_month}.txt")
path_monthly_mi_output_file <- glue::glue("Dataout/MI/monthly_processed/MI_{folder_month}.txt")
path_monthly_tpt_output_file <- glue::glue("Dataout/TPT/monthly_processed/TPT_{folder_month}.txt")
path_monthly_txtb_output_file <- glue::glue("Dataout/TXTB/monthly_processed/TXTB_{folder_month}.txt")
# paths for saving monthly datasets on google drive
path_monthly_imer_output_gdrive <- as_id("https://drive.google.com/drive/folders/12bkLnrQNXbKpbyo-zwk9dmxS6NHDyLwU")
path_monthly_prep_output_gdrive <- as_id("https://drive.google.com/drive/folders/1BYq-xdMhxw8sOUHYwFiZH8_w2UsQmBun")
path_monthly_dsd_output_gdrive <- as_id("https://drive.google.com/drive/folders/15x2biGIIYrY_eW-zrKQbrvMT47cI5yOE")
path_monthly_mi_output_gdrive <- as_id("https://drive.google.com/drive/folders/1RC5VFhD7XkuptW7o3zd21ujY6CefcTyv")
path_monthly_tpt_output_gdrive <- as_id("https://drive.google.com/drive/folders/1JobyoQqeTP3M5VvZWMC4AMBW04nVwDeD")
path_monthly_txtb_output_gdrive <- as_id("https://drive.google.com/drive/folders/1zKg8l6bmO_6uk9GoOmxYsAWP3msHtjB3")
# paths for saving historic datasets on local drive
path_historic_imer_output_file <- "Dataout/em_imer.txt"
path_historic_prep_output_file <- "Dataout/em_prep.txt"
path_historic_dsd_output_file <- "Dataout/em_dsd.txt"
path_historic_mi_output_file <- "Dataout/em_mi.txt"
path_historic_tpt_output_file <- "Dataout/em_tpt.txt"
path_historic_txtb_output_file <- "Dataout/em_txtb.txt"
# path for saving historical datasets on google drive
path_historic_output_gdrive <- as_id("https://drive.google.com/drive/folders/1xBcPZNAeYGahYj_cXN5aG2-_WSDLi6rQ")
ajuda_site_map <- pull_sitemap()
# imer
df_em_imer <- input_files %>%
map(~ reshape_em_imer(file.path(path_monthly_input_repo, .)), .progress	= TRUE) %>%
reduce(rbind)
library(tidyverse)
library(mozR)
library(glamr)
library(googlesheets4)
library(googledrive)
library(fs)
library(lubridate)
library(janitor)
library(readxl)
library(openxlsx)
library(glue)
library(gt)
load_secrets()
# folder where monthly submissions are stored. Update monthly!
folder_month <- "2023_06"
path_monthly_input_repo <- glue::glue("Data/Ajuda/ER_DSD_TPT_VL/{folder_month}/")
input_files <- dir({path_monthly_input_repo}, pattern = "*.xlsx")
# paths for saving monthly datasets on local drive
path_monthly_imer_output_file <- glue::glue("Dataout/IMER/monthly_processed/IMER_{folder_month}.txt")
path_monthly_prep_output_file <- glue::glue("Dataout/PrEP/monthly_processed/PREP_{folder_month}.txt")
path_monthly_dsd_output_file <- glue::glue("Dataout/DSD/monthly_processed/DSD_{folder_month}.txt")
path_monthly_mi_output_file <- glue::glue("Dataout/MI/monthly_processed/MI_{folder_month}.txt")
path_monthly_tpt_output_file <- glue::glue("Dataout/TPT/monthly_processed/TPT_{folder_month}.txt")
path_monthly_txtb_output_file <- glue::glue("Dataout/TXTB/monthly_processed/TXTB_{folder_month}.txt")
# paths for saving monthly datasets on google drive
path_monthly_imer_output_gdrive <- as_id("https://drive.google.com/drive/folders/12bkLnrQNXbKpbyo-zwk9dmxS6NHDyLwU")
path_monthly_prep_output_gdrive <- as_id("https://drive.google.com/drive/folders/1BYq-xdMhxw8sOUHYwFiZH8_w2UsQmBun")
path_monthly_dsd_output_gdrive <- as_id("https://drive.google.com/drive/folders/15x2biGIIYrY_eW-zrKQbrvMT47cI5yOE")
path_monthly_mi_output_gdrive <- as_id("https://drive.google.com/drive/folders/1RC5VFhD7XkuptW7o3zd21ujY6CefcTyv")
path_monthly_tpt_output_gdrive <- as_id("https://drive.google.com/drive/folders/1JobyoQqeTP3M5VvZWMC4AMBW04nVwDeD")
path_monthly_txtb_output_gdrive <- as_id("https://drive.google.com/drive/folders/1zKg8l6bmO_6uk9GoOmxYsAWP3msHtjB3")
# paths for saving historic datasets on local drive
path_historic_imer_output_file <- "Dataout/em_imer.txt"
path_historic_prep_output_file <- "Dataout/em_prep.txt"
path_historic_dsd_output_file <- "Dataout/em_dsd.txt"
path_historic_mi_output_file <- "Dataout/em_mi.txt"
path_historic_tpt_output_file <- "Dataout/em_tpt.txt"
path_historic_txtb_output_file <- "Dataout/em_txtb.txt"
# path for saving historical datasets on google drive
path_historic_output_gdrive <- as_id("https://drive.google.com/drive/folders/1xBcPZNAeYGahYj_cXN5aG2-_WSDLi6rQ")
# 1. LOAD SITE META DATA ---------------------------------------------------------------
# imer
df_em_imer <- input_files %>%
map(~ reshape_em_imer(file.path(path_monthly_input_repo, .)), .progress	= TRUE) %>%
reduce(rbind)
df <- read_excel("Data/Ajuda/ER_DSD_TPT_VL/2023_06/MonthlyEnhancedMonitoringTemplates_FY23Q3_1.2 FGH.xlsx",
sheet = "TX NEW, TX CURR AND IMER", skip = 8)
filename <- "Data/Ajuda/ER_DSD_TPT_VL/2023_06/MonthlyEnhancedMonitoringTemplates_FY23Q3_1.2 DOD.xlsx"
ip_temp <- extract_em_meta(filename, type = "ip")
month_temp <- extract_em_meta(filename, type = "month")
# imer
df_em_imer <- input_files %>%
map(~ reshape_em_imer(file.path(path_monthly_input_repo, .)), .progress	= TRUE) %>%
reduce(rbind)
# write_tsv NA values to ""
# check monthly submission headers
# DEPENDENCIES ------------------------------------------------------------
library(tidyverse)
library(mozR)
library(glamr)
library(googlesheets4)
library(googledrive)
library(fs)
library(lubridate)
library(janitor)
library(readxl)
library(openxlsx)
library(glue)
library(gt)
load_secrets()
# GLOBAL VARIABLES ---------------------------------------------------------------
# folder where monthly submissions are stored. Update monthly!
folder_month <- "2023_06"
path_monthly_input_repo <- glue::glue("Data/Ajuda/ER_DSD_TPT_VL/{folder_month}/")
input_files <- dir({path_monthly_input_repo}, pattern = "*.xlsx")
# paths for saving monthly datasets on local drive
path_monthly_imer_output_file <- glue::glue("Dataout/IMER/monthly_processed/IMER_{folder_month}.txt")
path_monthly_prep_output_file <- glue::glue("Dataout/PrEP/monthly_processed/PREP_{folder_month}.txt")
path_monthly_dsd_output_file <- glue::glue("Dataout/DSD/monthly_processed/DSD_{folder_month}.txt")
path_monthly_mi_output_file <- glue::glue("Dataout/MI/monthly_processed/MI_{folder_month}.txt")
path_monthly_tpt_output_file <- glue::glue("Dataout/TPT/monthly_processed/TPT_{folder_month}.txt")
path_monthly_txtb_output_file <- glue::glue("Dataout/TXTB/monthly_processed/TXTB_{folder_month}.txt")
# paths for saving monthly datasets on google drive
path_monthly_imer_output_gdrive <- as_id("https://drive.google.com/drive/folders/12bkLnrQNXbKpbyo-zwk9dmxS6NHDyLwU")
path_monthly_prep_output_gdrive <- as_id("https://drive.google.com/drive/folders/1BYq-xdMhxw8sOUHYwFiZH8_w2UsQmBun")
path_monthly_dsd_output_gdrive <- as_id("https://drive.google.com/drive/folders/15x2biGIIYrY_eW-zrKQbrvMT47cI5yOE")
path_monthly_mi_output_gdrive <- as_id("https://drive.google.com/drive/folders/1RC5VFhD7XkuptW7o3zd21ujY6CefcTyv")
path_monthly_tpt_output_gdrive <- as_id("https://drive.google.com/drive/folders/1JobyoQqeTP3M5VvZWMC4AMBW04nVwDeD")
path_monthly_txtb_output_gdrive <- as_id("https://drive.google.com/drive/folders/1zKg8l6bmO_6uk9GoOmxYsAWP3msHtjB3")
# paths for saving historic datasets on local drive
path_historic_imer_output_file <- "Dataout/em_imer.txt"
path_historic_prep_output_file <- "Dataout/em_prep.txt"
path_historic_dsd_output_file <- "Dataout/em_dsd.txt"
path_historic_mi_output_file <- "Dataout/em_mi.txt"
path_historic_tpt_output_file <- "Dataout/em_tpt.txt"
path_historic_txtb_output_file <- "Dataout/em_txtb.txt"
# path for saving historical datasets on google drive
path_historic_output_gdrive <- as_id("https://drive.google.com/drive/folders/1xBcPZNAeYGahYj_cXN5aG2-_WSDLi6rQ")
# 1. LOAD SITE META DATA ---------------------------------------------------------------
ajuda_site_map <- pull_sitemap()
# imer
df_em_imer <- input_files %>%
map(~ reshape_em_imer(file.path(path_monthly_input_repo, .)), .progress	= TRUE) %>%
reduce(rbind)
# prep
df_em_prep <- input_files %>%
map(~ reshape_em_prep(file.path(path_monthly_input_repo, .)), .progress	= TRUE) %>%
reduce(rbind)
# dsd
df_em_dsd <- input_files %>%
map(~ reshape_em_dsd(file.path(path_monthly_input_repo, .)), .progress	= TRUE) %>%
reduce(rbind)
input_files
# write_tsv NA values to ""
# check monthly submission headers
# DEPENDENCIES ------------------------------------------------------------
library(tidyverse)
library(mozR)
library(glamr)
library(googlesheets4)
library(googledrive)
library(fs)
library(lubridate)
library(janitor)
library(readxl)
library(openxlsx)
library(glue)
library(gt)
load_secrets()
# GLOBAL VARIABLES ---------------------------------------------------------------
# folder where monthly submissions are stored. Update monthly!
folder_month <- "2023_06"
path_monthly_input_repo <- glue::glue("Data/Ajuda/ER_DSD_TPT_VL/{folder_month}/")
input_files <- dir({path_monthly_input_repo}, pattern = "*.xlsx")
# paths for saving monthly datasets on local drive
path_monthly_imer_output_file <- glue::glue("Dataout/IMER/monthly_processed/IMER_{folder_month}.txt")
path_monthly_prep_output_file <- glue::glue("Dataout/PrEP/monthly_processed/PREP_{folder_month}.txt")
path_monthly_dsd_output_file <- glue::glue("Dataout/DSD/monthly_processed/DSD_{folder_month}.txt")
path_monthly_mi_output_file <- glue::glue("Dataout/MI/monthly_processed/MI_{folder_month}.txt")
path_monthly_tpt_output_file <- glue::glue("Dataout/TPT/monthly_processed/TPT_{folder_month}.txt")
path_monthly_txtb_output_file <- glue::glue("Dataout/TXTB/monthly_processed/TXTB_{folder_month}.txt")
# paths for saving monthly datasets on google drive
path_monthly_imer_output_gdrive <- as_id("https://drive.google.com/drive/folders/12bkLnrQNXbKpbyo-zwk9dmxS6NHDyLwU")
path_monthly_prep_output_gdrive <- as_id("https://drive.google.com/drive/folders/1BYq-xdMhxw8sOUHYwFiZH8_w2UsQmBun")
path_monthly_dsd_output_gdrive <- as_id("https://drive.google.com/drive/folders/15x2biGIIYrY_eW-zrKQbrvMT47cI5yOE")
path_monthly_mi_output_gdrive <- as_id("https://drive.google.com/drive/folders/1RC5VFhD7XkuptW7o3zd21ujY6CefcTyv")
path_monthly_tpt_output_gdrive <- as_id("https://drive.google.com/drive/folders/1JobyoQqeTP3M5VvZWMC4AMBW04nVwDeD")
path_monthly_txtb_output_gdrive <- as_id("https://drive.google.com/drive/folders/1zKg8l6bmO_6uk9GoOmxYsAWP3msHtjB3")
# paths for saving historic datasets on local drive
path_historic_imer_output_file <- "Dataout/em_imer.txt"
path_historic_prep_output_file <- "Dataout/em_prep.txt"
path_historic_dsd_output_file <- "Dataout/em_dsd.txt"
path_historic_mi_output_file <- "Dataout/em_mi.txt"
path_historic_tpt_output_file <- "Dataout/em_tpt.txt"
path_historic_txtb_output_file <- "Dataout/em_txtb.txt"
# path for saving historical datasets on google drive
path_historic_output_gdrive <- as_id("https://drive.google.com/drive/folders/1xBcPZNAeYGahYj_cXN5aG2-_WSDLi6rQ")
# 1. LOAD SITE META DATA ---------------------------------------------------------------
ajuda_site_map <- pull_sitemap()
# imer
df_em_imer <- input_files %>%
map(~ reshape_em_imer(file.path(path_monthly_input_repo, .)), .progress	= TRUE) %>%
reduce(rbind)
# prep
df_em_prep <- input_files %>%
map(~ reshape_em_prep(file.path(path_monthly_input_repo, .)), .progress	= TRUE) %>%
reduce(rbind)
# dsd
df_em_dsd <- input_files %>%
map(~ reshape_em_dsd(file.path(path_monthly_input_repo, .)), .progress	= TRUE) %>%
reduce(rbind)
# imer
df_em_imer <- input_files %>%
map(~ reshape_em_imer(file.path(path_monthly_input_repo, .)), .progress	= TRUE) %>%
reduce(rbind)
# prep
df_em_prep <- input_files %>%
map(~ reshape_em_prep(file.path(path_monthly_input_repo, .)), .progress	= TRUE) %>%
reduce(rbind)
# dsd
df_em_dsd <- input_files %>%
map(~ reshape_em_dsd(file.path(path_monthly_input_repo, .)), .progress	= TRUE) %>%
reduce(rbind)
# mi  the miscalc looks ok through this step
df_em_mi <- input_files %>%
map(~ reshape_em_mi(file.path(path_monthly_input_repo, .)), .progress	= TRUE) %>%
reduce(rbind)
# tpt
df_em_tpt <- input_files %>%
map(~ reshape_em_tpt(file.path(path_monthly_input_repo, .)), .progress	= TRUE) %>%
reduce(rbind)
# txtb
df_em_txtb <- input_files %>%
map(~ reshape_em_txtb(file.path(path_monthly_input_repo, .)), .progress	= TRUE) %>%
reduce(rbind) %>%
tidyr::pivot_wider(names_from = indicator, values_from = value) %>%
dplyr::group_by(partner, snu, psnu, sitename, datim_uid, period, disaggregate, sex, age) %>%
summarise(across(starts_with("TX_"), ~ mean(.x, na.rm = TRUE))) %>%
ungroup()
rm(list = ls())
library(tidyverse)
library(mozR)
year <- "2023"
cpn_path <- glue::glue("Data/MISAU/SMI/sisma_cpn_{year}.csv")
ats_results_path <- glue::glue("Data/MISAU/ATS/ats_results_{year}.csv")
ats_hist_path <- glue::glue("Data/MISAU/ATS/ats_hist_{year}.csv")
ats_ci_path <- glue::glue("Data/MISAU/ATS/ats_ci_lig_{year}.csv")
ats_ccsd_path <- glue::glue("Data/MISAU/ATS/ats_ccs_ccd_{year}.csv")
ats_saaj_path <- glue::glue("Data/MISAU/ATS/ats_saaj_cm_{year}.csv")
ats_smi_path <- glue::glue("Data/MISAU/ATS/ats_smi_{year}.csv")
ats_auto_path <- glue::glue("Data/MISAU/ATS/ats_autotest_{year}.csv")
hiv_tarv_path <- glue::glue("Data/MISAU/CT/tarv_{year}.csv")
df_ats <- bind_rows(process_sisma_csv(ats_results_path, type = "ATS Result"), # functional
process_sisma_csv(ats_hist_path, type = "ATS History"),   # functional
process_sisma_csv(ats_ci_path, type = "ATS CI"),          # functional
process_sisma_csv(ats_ccsd_path, type = "ATS CCSD"),      # functional
process_sisma_csv(ats_saaj_path, type = "ATS SAAJ"),      # functional prior to indicator map change
process_sisma_csv(ats_smi_path, type = "ATS SMI")         # functional prior to indicator map change
)
# write_tsv NA values to ""
# check monthly submission headers
# DEPENDENCIES ------------------------------------------------------------
library(tidyverse)
library(mozR)
library(glamr)
library(googlesheets4)
library(googledrive)
library(fs)
library(lubridate)
library(janitor)
library(readxl)
library(openxlsx)
library(glue)
library(gt)
load_secrets()
# GLOBAL VARIABLES ---------------------------------------------------------------
# folder where monthly submissions are stored. Update monthly!
folder_month <- "2023_06"
path_monthly_input_repo <- glue::glue("Data/Ajuda/ER_DSD_TPT_VL/{folder_month}/")
input_files <- dir({path_monthly_input_repo}, pattern = "*.xlsx")
# paths for saving monthly datasets on local drive
path_monthly_imer_output_file <- glue::glue("Dataout/IMER/monthly_processed/IMER_{folder_month}.txt")
path_monthly_prep_output_file <- glue::glue("Dataout/PrEP/monthly_processed/PREP_{folder_month}.txt")
path_monthly_dsd_output_file <- glue::glue("Dataout/DSD/monthly_processed/DSD_{folder_month}.txt")
path_monthly_mi_output_file <- glue::glue("Dataout/MI/monthly_processed/MI_{folder_month}.txt")
path_monthly_tpt_output_file <- glue::glue("Dataout/TPT/monthly_processed/TPT_{folder_month}.txt")
path_monthly_txtb_output_file <- glue::glue("Dataout/TXTB/monthly_processed/TXTB_{folder_month}.txt")
# paths for saving monthly datasets on google drive
path_monthly_imer_output_gdrive <- as_id("https://drive.google.com/drive/folders/12bkLnrQNXbKpbyo-zwk9dmxS6NHDyLwU")
path_monthly_prep_output_gdrive <- as_id("https://drive.google.com/drive/folders/1BYq-xdMhxw8sOUHYwFiZH8_w2UsQmBun")
path_monthly_dsd_output_gdrive <- as_id("https://drive.google.com/drive/folders/15x2biGIIYrY_eW-zrKQbrvMT47cI5yOE")
path_monthly_mi_output_gdrive <- as_id("https://drive.google.com/drive/folders/1RC5VFhD7XkuptW7o3zd21ujY6CefcTyv")
path_monthly_tpt_output_gdrive <- as_id("https://drive.google.com/drive/folders/1JobyoQqeTP3M5VvZWMC4AMBW04nVwDeD")
path_monthly_txtb_output_gdrive <- as_id("https://drive.google.com/drive/folders/1zKg8l6bmO_6uk9GoOmxYsAWP3msHtjB3")
# paths for saving historic datasets on local drive
path_historic_imer_output_file <- "Dataout/em_imer.txt"
path_historic_prep_output_file <- "Dataout/em_prep.txt"
path_historic_dsd_output_file <- "Dataout/em_dsd.txt"
path_historic_mi_output_file <- "Dataout/em_mi.txt"
path_historic_tpt_output_file <- "Dataout/em_tpt.txt"
path_historic_txtb_output_file <- "Dataout/em_txtb.txt"
# path for saving historical datasets on google drive
path_historic_output_gdrive <- as_id("https://drive.google.com/drive/folders/1xBcPZNAeYGahYj_cXN5aG2-_WSDLi6rQ")
# 1. LOAD SITE META DATA ---------------------------------------------------------------
ajuda_site_map <- pull_sitemap()
# imer
df_em_imer <- input_files %>%
map(~ reshape_em_imer(file.path(path_monthly_input_repo, .)), .progress	= TRUE) %>%
reduce(rbind)
# prep
df_em_prep <- input_files %>%
map(~ reshape_em_prep(file.path(path_monthly_input_repo, .)), .progress	= TRUE) %>%
reduce(rbind)
# dsd
df_em_dsd <- input_files %>%
map(~ reshape_em_dsd(file.path(path_monthly_input_repo, .)), .progress	= TRUE) %>%
reduce(rbind)
# mi  the miscalc looks ok through this step
df_em_mi <- input_files %>%
map(~ reshape_em_mi(file.path(path_monthly_input_repo, .)), .progress	= TRUE) %>%
reduce(rbind)
# tpt
df_em_tpt <- input_files %>%
map(~ reshape_em_tpt(file.path(path_monthly_input_repo, .)), .progress	= TRUE) %>%
reduce(rbind)
# txtb
df_em_txtb <- input_files %>%
map(~ reshape_em_txtb(file.path(path_monthly_input_repo, .)), .progress	= TRUE) %>%
reduce(rbind) %>%
tidyr::pivot_wider(names_from = indicator, values_from = value) %>%
dplyr::group_by(partner, snu, psnu, sitename, datim_uid, period, disaggregate, sex, age) %>%
summarise(across(starts_with("TX_"), ~ mean(.x, na.rm = TRUE))) %>%
ungroup()
